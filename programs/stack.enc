#! ../release/encorec -c

passive class Link
  elem : int
  next : Link
  def show() : void{
    print this.elem;
    if this.next != null then
      this.next.show()
    else
      ()}

class Stack
  top : Link
  def init() : void
    this.top = null
  def push(val : int) : void
    let newTop = new Link in
      {newTop.elem = val; 
       newTop.next = this.top; 
       this.top = newTop}
  def pop() : void
    if this.top != null then
      this.top = this.top.next
    else
      ()
  def top() : int
    this.top.elem
  def show() : void
    if this.top != null then
      this.top.show()
    else
      ()

class Pusher
  stack : Stack
  def init(stack : Stack) : void
    this.stack = stack
  def run() : void
    let i = 10000 in{
      while i > 0 {this.stack.push(i); i = i - 1};
      print "Pusher done"
    }

class Popper
  stack : Stack
  def init(stack : Stack) : void
    this.stack = stack
  def run() : void
    let i = 10000 in{
      while i > 0 {this.stack.pop(); i = i - 1};
      print "Popper done"
    }

class Main
  stack : Stack
  pusher : Pusher
  popper : Popper
  def main() : void{
    let stack  = new Stack()
        pusher = new Pusher(stack)
        popper = new Popper(stack)
    in
      this.pusher.run();
      this.popper.run();
      ()
  }